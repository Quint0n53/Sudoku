#include <iostream>
#include <time.h>
#include <vector>
#include <Windows.h>
#include <stdlib.h>

using namespace std;
int board[9][9] = { 0 };
int LockBoard[9][9] = { 0 };
vector<vector<vector<int>>> Vboard;//First num is col, second is row, third is pencils

void rows(int col, int row, int num) {//delete pencils from affected rows
	for (int i = 0; i < 9; i++) {//cycle through each vector for that row
		for (int j = 0; j < Vboard[i][row].size(); j++) {//cycle through all pencil marks
			if (Vboard[i][row][j] == num) {//if a pencil matches newly put number
				Vboard[i][row].erase(Vboard[i][row].begin() + j);//delete that sucker
				break;
			}
		}
	}
}
void cols(int col, int row, int num) {//delete pencils from affected cols
	for (int i = 0; i < 9; i++) {//cycle through each vector for that col
		for (int j = 0; j < Vboard[col][i].size(); j++) {//cycle through all pencil marks
			if (Vboard[col][i][j] == num) {//if a pencil matches newly put number
				Vboard[col][i].erase(Vboard[col][i].begin() + j);//delete that sucker
				break;
			}
		}
	}
}
void boxes(int col, int row, int num) {//delete pencils from affected boxes
	int colsHigh; 
	int colsLow;
	int rowsHigh;
	int rowsLow;
	if (col == 0 || col == 1 || col == 2) {//first 3 cols
		colsLow = 0;
		colsHigh = 3;
	}
	else if (col == 3 || col == 4 || col == 5) {//middle 3 cols
		colsLow = 3;
		colsHigh = 6;
	}
	else {//last 3 cols
		colsLow = 6;
		colsHigh = 9;
	}
	if (row == 0 || row == 1 || row == 2) {//top 3 rows
		rowsLow = 0;
		rowsHigh = 3;
	}
	else if (row == 3 || row == 4 || row == 5) {//middle 3 rows
		rowsLow = 3;
		rowsHigh = 6;
	}
	else {//bottom 3 rows
		rowsLow = 6;
		rowsHigh = 9;
	}
	for (int i = colsLow; i < colsHigh; i++) {//cycle thru cols
		for (int j = rowsLow; j < rowsHigh; j++) {//cycle thru rows
			for (int k = 0; k < Vboard[i][j].size(); k++) {//cycle thru pencils
				if (Vboard[i][j][k] == num) {//found it 
					Vboard[i][j].erase(Vboard[i][j].begin() + k);//delete that sucker
					break;
				}
			}
		}
	}
}
void print() {//print gameboard
	for (int i = 0; i < 9; i++) {
		for (int j = 0; j < 9; j++) {
			cout << board[i][j] << " ";//output number
			if ((j + 1) % 3 == 0) {//every 3rd coloum create extra space
				cout << " ";
			}
		}
		cout << endl;//create new row
		if ((i + 1) % 3 == 0) {//every 3rd row create extra row
			cout << endl;
		}
	}
}
void move() {//takes player move
	int row = 0;
	int col = 0;
	int num = 0;
	cout << "Please enter a column, row and number to replace with(in that order (C R N)):";
	cin >> row >> col >> num;
	for (;;) {
		if (0 > num || num > 9) {
			cout << "That number is invalid. Please enter a new number:";
			cin >> num;
		}
		else if (0 > row || row > 9) {
			cout << "That row is invalid. Please enter a new row:";
			cin >> row;
		}
		else if (0 > col || col > 9) {
			cout << "That column is invalid. Please enter a new number:";
			cin >> col;
		}
		else if (board[col - 1][row - 1] = LockBoard[col - 1][row - 1]) {
			cout << "That number is part of the original board. Do NOT touch. Try again:";
			cin >> row >> col >> num;
		}
		else {
			break;
		}
	}
	board[col - 1][row - 1] = num;
	system("CLS");
	print();
}
int number() {//start in square 1 and pick random number, after that remove 1 from all affected squares. Repeat 2-81
	for (int i = 0; i < 9; i++) {
		for (int j = 0; j < 9; j++) {
			//cout << "size: " << Vboard[i][j].size() << endl;
			if (Vboard[i][j].size() == 0) {//if broken restart
				return 0;
			}
			int random = rand() % (Vboard[i][j].size());
			board[i][j] = Vboard[i][j][random];
			rows(i, j, board[i][j]);
			cols(i, j, board[i][j]);
			boxes(i, j, board[i][j]);
		}
	}
	return 1;
}
void vectors() {//set vectors 1-9
	for (int k = 0; k < 9; k++) {
		vector<vector<int>> v2;
		for (int i = 0; i < 9; i++) {
			vector<int> v1;
			for (int j = 0; j < 9; j++) {
				v1.push_back(j + 1);//assign 1-9 to inside vector
			}
			v2.push_back(v1);//assign vectors to the vector
		}
		Vboard.push_back(v2);
	}
}
void reset() {
	for (int i = 0; i < 9; i++) {
		for (int j = 0; j < 9; j++) {
			board[i][j] = 0;
		}
	}
	Vboard.erase(Vboard.begin(), Vboard.begin() + Vboard.size());
}
void create() {
	for(;;) {
		vectors();//create vectors
		int check = number();//make board
		if (check == 0) {//fail restart
			reset();
		}else {//pass means output
			print();
			break;
		}
	} 
}
void difficulty(int hide) {
	int remove;
	for (;;) {
		if (hide == 1) {//easy
			remove = 24;
			break;
		}
		else if (hide == 2) {//medium
			remove = 32;
			break;
		}
		else if (hide == 3) {//hard
			remove = 40;
			break;
		}
		else {//try again
			cout << "You entered an invalid difficulty, Please enter a number between 1 and 3:";
			cin >> hide;
		}
	}
	for (int i = 0; i < remove; i++) {//do difficulty times
		for (;;) {//keep going until it finds an untouched number
			int row = rand() % 9;
			int col = rand() % 9;
			if (board[row][col] != 0) {//if number still there remove and proceed
				board[row][col] = 0;
				break;
			}
		}
	}
	for (int i = 0; i < 9; i++) {
		for (int j = 0; j < 9; j++) {
			LockBoard[i][j] = board[i][j];//create new board to compare playable actions against
		}
	}
}
int full() {//If no 0s then begin solve process
	for (int i = 0; i < 9; i++) {//cycle rows
		for (int j = 0; j < 9; j++) {//cycle cols
			if (board[i][j] == 0) {//if 0 return to play
				return 0;
			}
		}
	}
	return 1;//if all are ones, begin solve
}
void clear(char fill = ' ') {
	COORD tl = { 0,0 };
	CONSOLE_SCREEN_BUFFER_INFO s;
	HANDLE console = GetStdHandle(STD_OUTPUT_HANDLE);
	GetConsoleScreenBufferInfo(console, &s);
	DWORD written, cells = s.dwSize.X * s.dwSize.Y;
	FillConsoleOutputCharacter(console, fill, cells, tl, &written);
	FillConsoleOutputAttribute(console, s.wAttributes, cells, tl, &written);
	SetConsoleCursorPosition(console, tl);
}
int solve() {//solves for any board, it solves independantly of the original board. Hoping it would "catch" any mistakes
	for (int i = 0; i < 9; i++) {//cycle through all numbers of the board
		for (int j = 0; j < 9; j++) {
			int number = board[i][j];
			for (int k = 0; k < 9; k++) {//check col
				if (k == i) {//if its the same as current box, skip
					continue;
				}
				else if (number == board[k][j]) {//if same num, tell user they failed and check again. Output which box broke
					cout << "This board is not correct, Please try again\n";
					cout << "A box that caused the error is column " << i+1 << ", row " << j +1<< endl;
					return 0;
				}
			}
			for (int k = 0; k < 9; k++) {//check row
				if (k == j) {//if its the same as current box, skip
					continue;
				}
				else if (number == board[i][k]) {//if same num, tell user they failed and check again. Output which box broke
					cout << "This board is not correct, Please try again\n";
					cout << "A box that caused the error is column " << i +1<< ", row " << j +1<< endl;
					return 0;
				}
			}//check box
			int colsHigh = 0;
			int colsLow = 0;
			int rowsHigh= 0;
			int rowsLow= 0;
			if (i == 0 || i == 1 || i == 2) {//first 3 cols
				colsLow = 0;
				colsHigh = 3;
			}
			else if (i == 3 || i == 4 || i == 5) {//middle 3 cols
				colsLow = 3;
				colsHigh = 6;
			}
			else {//last 3 cols
				colsLow = 6;
				colsHigh = 9;
			}
			if (j == 0 || j == 1 || j == 2) {//top 3 rows
				rowsLow = 0;
				rowsHigh = 3;
			}
			else if (j == 3 || j == 4 || j == 5) {//middle 3 rows
				rowsLow = 3;
				rowsHigh = 6;
			}
			else {//bottom 3 rows
				rowsLow = 6;
				rowsHigh = 9;
			}
			for (int k = colsLow; k < colsHigh; k++) {//cycle thru cols
				for (int l = rowsLow; l < rowsHigh; l++) {//cycle thru rows
					if (k == i && l == j) {//if same coord, keep moving
						continue;
					}
					else if (number == board[k][l]) {
						cout << "This board is not correct, please try again\n";
						cout << "A box that caused the error is column " << i + 1<< ", row " << j + 1<< endl;
						return 0;
					}
				}
			}
		}
	}
	cout << "Congratulations, You solved the board!\n";
	return 0;
}
int main() {
	srand(time(NULL));
	cout << "Welcome to the Sudoku board generator\n";
	create();//create board
	int level;
	cout << "What level of difficulty would you like?\n1 = Easy\n2 = Medium\n3 = Hard\n";
	cin >> level;
	difficulty(level);
	print();
	for (;;) {//play
		move();
		if (full() == 1) {
			break;
		}
	}
	solve();
	system("pause");
	return 0;
}
